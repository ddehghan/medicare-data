{% extends 'theme/base.html' %}
{% load i18n %}

{% trans "This is the title" as the_title %}

{% block meta_description %}{{ the_title }}{% endblock %}
{% block title %}{{ the_title }}{% endblock %}

{% block extra_css %}

    <style>
        path {
            stroke: white;
            stroke-width: 0.25px;
            fill: grey;
        }

        .hover-text {
            height: 50px;
        }

        .hover-text .avg-price {
            font-size: 16px;
        }

        #default_image {
            height: 300px;
        }

        #drug_name {
            display: inline;
            width: 500px;
        }

    </style>
    <script src="{{ STATIC_URL }}js/d3.v3.min.js"></script>
    <script src="{{ STATIC_URL }}js/topojson.v0.min.js"></script>

    <script src="{{ STATIC_URL }}js/jquery.tipsy.js"></script>

    <link href="{{ STATIC_URL }}css/tipsy.css" rel="stylesheet">

{% endblock %}


{% block maincontent %}
    <div class="promotion-row row-fluid">
        <div class="span6">
            <h2>Vastly different price for the same procedure</h2>

            <div class="social-box">
                <span class='st_facebook_hcount' displayText='Facebook'></span>
                <span class='st_twitter_hcount' displayText='Tweet' st_via='drawtf'
                      st_title='Help me fund education of kids at this school. #drawthefuture #education'></span>
                <span class='st_googleplus_hcount' displayText='Google +'></span>
                <span class='st_sharethis_hcount' displayText='Share'></span>
            </div>

        </div>
        <div class="span6">
            <div id="default_image">
                <img src="{{ STATIC_URL }}images/default_image.png">
            </div>
        </div>
    </div>

    <div class="promotion-row row-fluid">
        <div class="span12">
            <h2>Medicare Provider Charge Data:</h2>
            <select id="drug_name">
                <option value="1" selected="selected">247 - PERC CARDIOVASC PROC W DRUG-ELUTING STENT W/O MCC</option>
                <option value="2">039 - EXTRACRANIAL PROCEDURES W/O CC/MCC</option>
                <option value="3">291 - HEART FAILURE & SHOCK W MCC</option>
            </select>
            <button type="button" onclick="spinner_on()" style="display: inline;">Display</button>

            <div id="chart"></div>
        </div>
    </div>

    <div class="promotion-row row-fluid">
        <div class="span12">
            <h3>Medicare Provider Charge Data</h3>

            <p>As part of the Obama administrationâ€™s work to make our health care system more affordable and
                accountable, data are being released that show significant variation across the country and within
                communities in what hospitals charge for common inpatient services.</p>

            <p>The data provided here include hospital-specific charges for the more than 3,000 U.S. hospitals that
                receive Medicare Inpatient Prospective Payment System (IPPS) payments for the top 100 most frequently
                billed discharges, paid under Medicare based on a rate per discharge using the Medicare Severity
                Diagnosis Related Group (MS-DRG) for Fiscal Year (FY) 2011. These DRGs represent almost 7 million
                discharges or 60 percent of total Medicare IPPS discharges.</p>

            <p>Hospitals determine what they will charge for items and services provided to patients and these charges
                are the amount the hospital bills for an item or service. The Total Payment amount includes the MS-DRG
                amount, bill total per diem, beneficiary primary payer claim payment amount, beneficiary Part A
                coinsurance amount, beneficiary deductible amount, beneficiary blood deducible amount and DRG outlier
                amount.</p>

            <p>For these DRGs, average charges and average Medicare payments are calculated at the individual hospital
                level. Users will be able to make comparisons between the amount charged by individual hospitals within
                local markets, and nationwide, for services that might be furnished in connection with a particular
                inpatient stay.</p>

            <p>Data are being made available in Microsoft Excel (.xlsx) format and comma separated values (.csv)
                format.</p>

            <p>
                <a href="http://www.cms.gov/Research-Statistics-Data-and-Systems/Statistics-Trends-and-Reports/Medicare-Provider-Charge-Data/Downloads/IPPS_DRG_XLSX.zip">Inpatient
                    Charge Data, FY2011, Microsoft Excel version<br/></a><a
                    href="http://www.cms.gov/Research-Statistics-Data-and-Systems/Statistics-Trends-and-Reports/Medicare-Provider-Charge-Data/Downloads/IPPS_DRG_CSV.zip">Inpatient
                Charge Data, FY2011, Comma Separated Values (CSV) version</a></p>

            <p><br/>National and State level summaries are also available here:</p>

            <p>
                <a href="http://www.cms.gov/Research-Statistics-Data-and-Systems/Statistics-Trends-and-Reports/Medicare-Provider-Charge-Data/Downloads/IPPS_NAT_STATE_SUM_XLSX.zip">National
                    and State Summaries of Inpatient Charge Data, FY2011, Microsoft Excel version</a><br/><a
                    href="http://www.cms.gov/Research-Statistics-Data-and-Systems/Statistics-Trends-and-Reports/Medicare-Provider-Charge-Data/Downloads/IPPS_NAT_STATE_SUM_CSV.zip">National
                and State Summaries of Inpatient Charge Data, FY2011, Comma Separated Values (CSV) version</a></p>
        </div>
    </div>

    <div class="promotion-row row-fluid">
        <div class="span6">
            <img src="{{ STATIC_URL }}images/time_cover.jpg">

            <h3>Bitter Pill: Why Medical Bills Are Killing Us</h3>

            <a href="http://www.time.com/time/magazine/article/0,9171,2136864,00.html#ixzz2Sw4Yxq6j">Read more</a> (Pay
            Wall)
            <a href="http://www.pharmacyreviewer.com/forum/news-related-online-pharmacies/33668-time-magazine-special-report-why-medical-bills-killing-us-mar-4-2013-chapter-1-a.html">Read
                more</a>
        </div>
        <div class="span6">
        </div>
    </div>



{% endblock %}


{% block bottomscript %}
    <script>

        {#    http://www.schneidy.com/Tutorials/MapsTutorial.html#}

        function draw_chart(drug) {

            var centered;

            var width = 1200, height = 700;

            var svg = d3.select("#chart").append("svg")
                    .attr("width", width)
                    .attr("height", height);

            var group = svg.append("g");

            var projection = d3.geo.albersUsa();
            var path = d3.geo.path().projection(projection);

            group.attr('transorm', 'scale(.3, .3)');

            d3.json('{{ STATIC_URL }}json/us-states.json', function (collection) {
                group.selectAll('path')
                        .data(collection.features)
                        .enter().append('path')
                        .attr('d', d3.geo.path().projection(projection))
                        .attr('id', function (d) {
                            return d.properties.name.replace(/\s+/g, '')
                        })
                        .style('fill', 'gray')
                        .style('stroke', 'white')
                        .style('stroke-width', 1)
                        .on('click', click);

                function click(d) {
                    var x = 0,
                            y = 0,
                            k = .8;

                    if (d && centered !== d) {
                        var centroid = path.centroid(d);
                        x = -centroid[0] + width / 8;
                        y = -centroid[1] + height / 8;
                        k = 4;
                        centered = d;
                    } else {
                        centered = null;
                    }

                    group.selectAll("path")
                            .classed("active", centered && function (d) {
                                return d === centered;
                            });

                    group.transition()
                            .duration(1000)
                            .attr("transform", "scale(" + k + ")translate(" + x + width / 4 + "," + y + ")")
                            .style("stroke-width", 1.5 / k + "px");
                }

                d3.csv("charges/" + drug, function (error, data) {
                    group.selectAll("circle")
                            .data(data)
                            .enter()
                            .append("circle")
                            .attr("cx", function (d) {
                                return projection([d.lon, d.lat])[0];
                            })
                            .attr("cy", function (d) {
                                return projection([d.lon, d.lat])[1];
                            })
                            .attr("r", function (d) {
                                return d.size;
                            })
                            .style("fill", "red");

                    $('svg circle').tipsy({
                        gravity: 'w',
                        html: true,
                        title: function () {
                            var d = this.__data__;

                            return "<div class='hover-text'><div class='hospital-name'>" + d.name
                                    + "</div><div class='avg-price'>Average Price: $" + formatMoney(d.price, 0, '.', ',')
                                    + "</div></div>";
                        }
                    });


                });
            });
        }

        function spinner_on() {
            $("svg").remove();

            var e = document.getElementById("drug_name");
            var drug = e.options[e.selectedIndex].text;

            draw_chart(drug);

        }


        function formatMoney(n, c, d, t) {
            var c = isNaN(c = Math.abs(c)) ? 2 : c,
                    d = d == undefined ? "." : d,
                    t = t == undefined ? "," : t,
                    s = n < 0 ? "-" : "",
                    i = parseInt(n = Math.abs(+n || 0).toFixed(c)) + "",
                    j = (j = i.length) > 3 ? j % 3 : 0;
            return s + (j ? i.substr(0, j) + t : "") + i.substr(j).replace(/(\d{3})(?=\d)/g, "$1" + t) + (c ? d + Math.abs(n - i).toFixed(c).slice(2) : "");
        }
    </script>

    <script type="text/javascript">
        var switchTo5x = false;
    </script>
    <script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
    <script type="text/javascript">
        stLight.options({
            publisher: "6d8da8ae-b61c-486f-a29b-e4c32b2e3259",
            doNotHash: false,
            doNotCopy: false,
            hashAddressBar: false
        });
    </script>

{% endblock %}
