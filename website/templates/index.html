{% extends 'theme/base.html' %}
{% load i18n %}

{% trans "This is the title" as the_title %}

{% block meta_description %}{{ the_title }}{% endblock %}
{% block title %}{{ the_title }}{% endblock %}

{% block extra_css %}

    <style>
        path {
            stroke: white;
            stroke-width: 0.25px;
            fill: grey;
        }

        .hover-text {
            height: 50px;
        }

        .hover-text .avg-price {
            font-size: 16px;
        }

        #default_image {
            height: 300px;
            margin-top: 80px;
        }

        #drug_name {
            display: inline;
            width: 600px;
        }

        .instructions {
            font-size: 22px;
            line-height: 35px;
        }

        .big-arrow {
            margin-bottom: 30px;
        }

        .big-top-margin {
            margin-top: 75px;
        }

        .news-image {
        }

    </style>
    <script src="{{ STATIC_URL }}js/d3.v3.min.js"></script>
    <script src="{{ STATIC_URL }}js/topojson.v0.min.js"></script>

    <script src="{{ STATIC_URL }}js/jquery.tipsy.js"></script>

    <link href="{{ STATIC_URL }}css/tipsy.css" rel="stylesheet">

{% endblock %}


{% block maincontent %}
    <div class="big-top-margin row-fluid">
        <div class="span7">
            <h2>Vastly different price for the same procedure</h2>
            bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla
            bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla
            bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla
            bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla
            bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla
            bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla
            bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla
            bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla
            bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla
            bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla
            bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla
            bla bla bla bla bla bla bla bla bla bla bla bla bla bla
        </div>
        <div class="span5">
            <div id="default_image">
                <img src="{{ STATIC_URL }}images/default_image.png">
            </div>
            <div class="social-box">
                <span class='st_facebook_hcount' displayText='Facebook'></span>
                <span class='st_twitter_hcount' displayText='Tweet' st_via='ddehghan'
                      st_title='Medicare price variation between hospitals #health #medicare'></span>
                <span class='st_googleplus_hcount' displayText='Google +'></span>
                <span class='st_sharethis_hcount' displayText='Share'></span>
            </div>
        </div>
    </div>

    <div class="big-top-margin row-fluid">
        <div class="offset1 span8">
            <h2>View Medicare pyament rate:</h2>
            <select id="drug_name">
                <option value='1' selected="selected">563 - FX, SPRN, STRN & DISL EXCEPT FEMUR, HIP, PELVIS & THIGH W/O MCC</option>
                <option value='2'>287 - CIRCULATORY DISORDERS EXCEPT AMI, W CARD CATH W/O MCC</option>
                <option value='3'>480 - HIP & FEMUR PROCEDURES EXCEPT MAJOR JOINT W MCC</option>
                <option value='4'>057 - DEGENERATIVE NERVOUS SYSTEM DISORDERS W/O MCC</option>
                <option value='5'>176 - PULMONARY EMBOLISM W/O MCC</option>
                <option value='6'>149 - DYSEQUILIBRIUM</option>
                <option value='7'>918 - POISONING & TOXIC EFFECTS OF DRUGS W/O MCC</option>
                <option value='8'>291 - HEART FAILURE & SHOCK W MCC</option>
                <option value='9'>684 - RENAL FAILURE W/O CC/MCC</option>
                <option value='10'>247 - PERC CARDIOVASC PROC W DRUG-ELUTING STENT W/O MCC</option>
                <option value='11'>065 - INTRACRANIAL HEMORRHAGE OR CEREBRAL INFARCTION W CC</option>
                <option value='12'>293 - HEART FAILURE & SHOCK W/O CC/MCC</option>
                <option value='13'>390 - G.I. OBSTRUCTION W/O CC/MCC</option>
                <option value='14'>699 - OTHER KIDNEY & URINARY TRACT DIAGNOSES W CC</option>
                <option value='15'>305 - HYPERTENSION W/O MCC</option>
                <option value='16'>470 - MAJOR JOINT REPLACEMENT OR REATTACHMENT OF LOWER EXTREMITY W/O MCC</option>
                <option value='17'>243 - PERMANENT CARDIAC PACEMAKER IMPLANT W CC</option>
                <option value='18'>389 - G.I. OBSTRUCTION W CC</option>
                <option value='19'>536 - FRACTURES OF HIP & PELVIS W/O MCC</option>
                <option value='20'>811 - RED BLOOD CELL DISORDERS W MCC</option>
                <option value='21'>281 - ACUTE MYOCARDIAL INFARCTION, DISCHARGED ALIVE W CC</option>
                <option value='22'>314 - OTHER CIRCULATORY SYSTEM DIAGNOSES W MCC</option>
                <option value='23'>252 - OTHER VASCULAR PROCEDURES W MCC</option>
                <option value='24'>193 - SIMPLE PNEUMONIA & PLEURISY W MCC</option>
                <option value='25'>064 - INTRACRANIAL HEMORRHAGE OR CEREBRAL INFARCTION W MCC</option>
                <option value='26'>202 - BRONCHITIS & ASTHMA W CC/MCC</option>
                <option value='27'>282 - ACUTE MYOCARDIAL INFARCTION, DISCHARGED ALIVE W/O CC/MCC</option>
                <option value='28'>683 - RENAL FAILURE W CC</option>
                <option value='29'>948 - SIGNS & SYMPTOMS W/O MCC</option>
                <option value='30'>069 - TRANSIENT ISCHEMIA</option>
                <option value='31'>177 - RESPIRATORY INFECTIONS & INFLAMMATIONS W MCC</option>
                <option value='32'>378 - G.I. HEMORRHAGE W CC</option>
                <option value='33'>074 - CRANIAL & PERIPHERAL NERVE DISORDERS W/O MCC</option>
                <option value='34'>178 - RESPIRATORY INFECTIONS & INFLAMMATIONS W CC</option>
                <option value='35'>280 - ACUTE MYOCARDIAL INFARCTION, DISCHARGED ALIVE W MCC</option>
                <option value='36'>870 - SEPTICEMIA OR SEVERE SEPSIS W MV 96+ HOURS</option>
                <option value='37'>253 - OTHER VASCULAR PROCEDURES W CC</option>
                <option value='38'>303 - ATHEROSCLEROSIS W/O MCC</option>
                <option value='39'>301 - PERIPHERAL VASCULAR DISORDERS W/O CC/MCC</option>
                <option value='40'>313 - CHEST PAIN</option>
                <option value='41'>469 - MAJOR JOINT REPLACEMENT OR REATTACHMENT OF LOWER EXTREMITY W MCC</option>
                <option value='42'>238 - MAJOR CARDIOVASC PROCEDURES W/O MCC</option>
                <option value='43'>491 - BACK & NECK PROC EXC SPINAL FUSION W/O CC/MCC</option>
                <option value='44'>066 - INTRACRANIAL HEMORRHAGE OR CEREBRAL INFARCTION W/O CC/MCC</option>
                <option value='45'>194 - SIMPLE PNEUMONIA & PLEURISY W CC</option>
                <option value='46'>377 - G.I. HEMORRHAGE W MCC</option>
                <option value='47'>460 - SPINAL FUSION EXCEPT CERVICAL W/O MCC</option>
                <option value='48'>871 - SEPTICEMIA OR SEVERE SEPSIS W/O MV 96+ HOURS W MCC</option>
                <option value='49'>244 - PERMANENT CARDIAC PACEMAKER IMPLANT W/O CC/MCC</option>
                <option value='50'>552 - MEDICAL BACK PROBLEMS W/O MCC</option>
                <option value='51'>391 - ESOPHAGITIS, GASTROENT & MISC DIGEST DISORDERS W MCC</option>
                <option value='52'>690 - KIDNEY & URINARY TRACT INFECTIONS W/O MCC</option>
                <option value='53'>439 - DISORDERS OF PANCREAS EXCEPT MALIGNANCY W CC</option>
                <option value='54'>308 - CARDIAC ARRHYTHMIA & CONDUCTION DISORDERS W MCC</option>
                <option value='55'>473 - CERVICAL SPINAL FUSION W/O CC/MCC</option>
                <option value='56'>191 - CHRONIC OBSTRUCTIVE PULMONARY DISEASE W CC</option>
                <option value='57'>379 - G.I. HEMORRHAGE W/O CC/MCC</option>
                <option value='58'>603 - CELLULITIS W/O MCC</option>
                <option value='59'>394 - OTHER DIGESTIVE SYSTEM DIAGNOSES W CC</option>
                <option value='60'>330 - MAJOR SMALL & LARGE BOWEL PROCEDURES W CC</option>
                <option value='61'>641 - MISC DISORDERS OF NUTRITION,METABOLISM,FLUIDS/ELECTROLYTES W/O MCC</option>
                <option value='62'>419 - LAPAROSCOPIC CHOLECYSTECTOMY W/O C.D.E. W/O CC/MCC</option>
                <option value='63'>189 - PULMONARY EDEMA & RESPIRATORY FAILURE</option>
                <option value='64'>885 - PSYCHOSES</option>
                <option value='65'>251 - PERC CARDIOVASC PROC W/O CORONARY ARTERY STENT W/O MCC</option>
                <option value='66'>640 - MISC DISORDERS OF NUTRITION,METABOLISM,FLUIDS/ELECTROLYTES W MCC</option>
                <option value='67'>812 - RED BLOOD CELL DISORDERS W/O MCC</option>
                <option value='68'>192 - CHRONIC OBSTRUCTIVE PULMONARY DISEASE W/O CC/MCC</option>
                <option value='69'>309 - CARDIAC ARRHYTHMIA & CONDUCTION DISORDERS W CC</option>
                <option value='70'>310 - CARDIAC ARRHYTHMIA & CONDUCTION DISORDERS W/O CC/MCC</option>
                <option value='71'>203 - BRONCHITIS & ASTHMA W/O CC/MCC</option>
                <option value='72'>292 - HEART FAILURE & SHOCK W CC</option>
                <option value='73'>329 - MAJOR SMALL & LARGE BOWEL PROCEDURES W MCC</option>
                <option value='74'>698 - OTHER KIDNEY & URINARY TRACT DIAGNOSES W MCC</option>
                <option value='75'>249 - PERC CARDIOVASC PROC W NON-DRUG-ELUTING STENT W/O MCC</option>
                <option value='76'>286 - CIRCULATORY DISORDERS EXCEPT AMI, W CARD CATH W MCC</option>
                <option value='77'>372 - MAJOR GASTROINTESTINAL DISORDERS & PERITONEAL INFECTIONS W CC</option>
                <option value='78'>190 - CHRONIC OBSTRUCTIVE PULMONARY DISEASE W MCC</option>
                <option value='79'>254 - OTHER VASCULAR PROCEDURES W/O CC/MCC</option>
                <option value='80'>853 - INFECTIOUS & PARASITIC DISEASES W O.R. PROCEDURE W MCC</option>
                <option value='81'>195 - SIMPLE PNEUMONIA & PLEURISY W/O CC/MCC</option>
                <option value='82'>300 - PERIPHERAL VASCULAR DISORDERS W CC</option>
                <option value='83'>039 - EXTRACRANIAL PROCEDURES W/O CC/MCC</option>
                <option value='84'>392 - ESOPHAGITIS, GASTROENT & MISC DIGEST DISORDERS W/O MCC</option>
                <option value='85'>312 - SYNCOPE & COLLAPSE</option>
                <option value='86'>872 - SEPTICEMIA OR SEVERE SEPSIS W/O MV 96+ HOURS W/O MCC</option>
                <option value='87'>917 - POISONING & TOXIC EFFECTS OF DRUGS W MCC</option>
                <option value='88'>207 - RESPIRATORY SYSTEM DIAGNOSIS W VENTILATOR SUPPORT 96+ HOURS</option>
                <option value='89'>482 - HIP & FEMUR PROCEDURES EXCEPT MAJOR JOINT W/O CC/MCC</option>
                <option value='90'>638 - DIABETES W CC</option>
                <option value='91'>689 - KIDNEY & URINARY TRACT INFECTIONS W MCC</option>
                <option value='92'>418 - LAPAROSCOPIC CHOLECYSTECTOMY W/O C.D.E. W CC</option>
                <option value='93'>481 - HIP & FEMUR PROCEDURES EXCEPT MAJOR JOINT W CC</option>
                <option value='94'>208 - RESPIRATORY SYSTEM DIAGNOSIS W VENTILATOR SUPPORT <96 HOURS</option>
                <option value='95'>602 - CELLULITIS W MCC</option>
                <option value='96'>682 - RENAL FAILURE W MCC</option>
                <option value='97'>315 - OTHER CIRCULATORY SYSTEM DIAGNOSES W CC</option>
                <option value='98'>897 - ALCOHOL/DRUG ABUSE OR DEPENDENCE W/O REHABILITATION THERAPY W/O MCC</option>
                <option value='99'>101 - SEIZURES W/O MCC</option>
                <option value='100'>246 - PERC CARDIOVASC PROC W DRUG-ELUTING STENT W MCC OR 4+ VESSELS/STENTS</option>
            </select>
            <button type="button" class="btn btn-danger" onclick="spinner_on()">View Prices</button>
        </div>

        <div class="span3 visible-desktop">
            <img class="big-arrow" src="{{ STATIC_URL }}images/arrow_yellow.png">
            <br>

            <div class="instructions">
                1) Select a Procedure <br>
                2) View prices <br>
                3) Hover over dots
            </div>
        </div>
    </div>

    <div class="row-fluid">
        <div class="span12">
            <div id="chart"></div>
        </div>
    </div>

    <div class="big-top-margin row-fluid">
        <div class="span12">
            <h3>Data from CMS.GOV</h3>

            <a href="http://www.cms.gov/Research-Statistics-Data-and-Systems/Statistics-Trends-and-Reports/Medicare-Provider-Charge-Data/index.html">Medicare
                Provider Charge Data</a>

            <p>As part of the Obama administration’s work to make our health care system more affordable and
                accountable, data are being released that show significant variation across the country and within
                communities in what hospitals charge for common inpatient services.</p>

            <p>The data provided here include hospital-specific charges for the more than 3,000 U.S. hospitals that
                receive Medicare Inpatient Prospective Payment System (IPPS) payments for the top 100 most frequently
                billed discharges, paid under Medicare based on a rate per discharge using the Medicare Severity
                Diagnosis Related Group (MS-DRG) for Fiscal Year (FY) 2011. These DRGs represent almost 7 million
                discharges or 60 percent of total Medicare IPPS discharges.</p>

            <p>Hospitals determine what they will charge for items and services provided to patients and these charges
                are the amount the hospital bills for an item or service. The Total Payment amount includes the MS-DRG
                amount, bill total per diem, beneficiary primary payer claim payment amount, beneficiary Part A
                coinsurance amount, beneficiary deductible amount, beneficiary blood deducible amount and DRG outlier
                amount.</p>

            <p>For these DRGs, average charges and average Medicare payments are calculated at the individual hospital
                level. Users will be able to make comparisons between the amount charged by individual hospitals within
                local markets, and nationwide, for services that might be furnished in connection with a particular
                inpatient stay.</p>

            <p>Data are being made available in Microsoft Excel (.xlsx) format and comma separated values (.csv)
                format.</p>

            <p>
                <a href="http://www.cms.gov/Research-Statistics-Data-and-Systems/Statistics-Trends-and-Reports/Medicare-Provider-Charge-Data/Downloads/IPPS_DRG_XLSX.zip">Inpatient
                    Charge Data, FY2011, Microsoft Excel version<br/></a><a
                    href="http://www.cms.gov/Research-Statistics-Data-and-Systems/Statistics-Trends-and-Reports/Medicare-Provider-Charge-Data/Downloads/IPPS_DRG_CSV.zip">Inpatient
                Charge Data, FY2011, Comma Separated Values (CSV) version</a></p>

            <p><br/>National and State level summaries are also available here:</p>

            <p>
                <a href="http://www.cms.gov/Research-Statistics-Data-and-Systems/Statistics-Trends-and-Reports/Medicare-Provider-Charge-Data/Downloads/IPPS_NAT_STATE_SUM_XLSX.zip">National
                    and State Summaries of Inpatient Charge Data, FY2011, Microsoft Excel version</a><br/><a
                    href="http://www.cms.gov/Research-Statistics-Data-and-Systems/Statistics-Trends-and-Reports/Medicare-Provider-Charge-Data/Downloads/IPPS_NAT_STATE_SUM_CSV.zip">National
                and State Summaries of Inpatient Charge Data, FY2011, Comma Separated Values (CSV) version</a></p>
        </div>
    </div>

    <div class="big-top-margin row-fluid">
        <div class="span12">

            <h3>In the News:</h3>

            <div class="news">
                <table>
                    <tr>
                        <td>
                            <img class="news-image" src="{{ STATIC_URL }}images/time_cover.jpg">
                        </td>
                        <td><h3>Bitter Pill: Why Medical Bills Are Killing Us</h3>
                            <a href="http://www.time.com/time/magazine/article/0,9171,2136864,00.html#ixzz2Sw4Yxq6j">
                                Read more (Pay Wall)</a>
                            <a href="http://www.pharmacyreviewer.com/forum/news-related-online-pharmacies/33668-time-magazine-special-report-why-medical-bills-killing-us-mar-4-2013-chapter-1-a.html">Read
                                more</a>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <img class="news-image" src="{{ STATIC_URL }}images/planet_money.png">
                        </td>
                        <td><h3>Planet Money: The Mysterious Power Of A Hospital Bill</h3>
                            <a href="http://www.npr.org/blogs/money/2013/02/26/172996963/episode-439-the-mysterious-power-of-a-hospital-bill">
                                Read more</a>
                        </td>
                    </tr>
                </table>


            </div>
        </div>
    </div>



{% endblock %}


{% block bottomscript %}
    <script>

        {#    http://www.schneidy.com/Tutorials/MapsTutorial.html#}

        function draw_chart(drg_num) {

            var centered;

            var width = 1200, height = 700;

            var svg = d3.select("#chart").append("svg")
                    .attr("width", width)
                    .attr("height", height);

            var group = svg.append("g");

            var projection = d3.geo.albersUsa();
            var path = d3.geo.path().projection(projection);

            group.attr('transorm', 'scale(.3, .3)');

            d3.json('{{ STATIC_URL }}json/us-states.json', function (collection) {
                group.selectAll('path')
                        .data(collection.features)
                        .enter().append('path')
                        .attr('d', d3.geo.path().projection(projection))
                        .attr('id', function (d) {
                            return d.properties.name.replace(/\s+/g, '')
                        })
                        .style('fill', 'gray')
                        .style('stroke', 'white')
                        .style('stroke-width', 1)
                        .on('click', click);

                function click(d) {
                    var x = 0,
                            y = 0,
                            k = .8;

                    if (d && centered !== d) {
                        var centroid = path.centroid(d);
                        x = -centroid[0] + width / 8;
                        y = -centroid[1] + height / 8;
                        k = 4;
                        centered = d;
                    } else {
                        centered = null;
                    }

                    group.selectAll("path")
                            .classed("active", centered && function (d) {
                                return d === centered;
                            });

                    group.transition()
                            .duration(1000)
                            .attr("transform", "scale(" + k + ")translate(" + x + width / 4 + "," + y + ")")
                            .style("stroke-width", 1.5 / k + "px");
                }

                d3.csv('{{ STATIC_URL }}data/' + drg_num + '.csv', function (error, data) {
                    group.selectAll("circle")
                            .data(data)
                            .enter()
                            .append("circle")
                            .attr("cx", function (d) {
                                return projection([d.lon, d.lat])[0];
                            })
                            .attr("cy", function (d) {
                                return projection([d.lon, d.lat])[1];
                            })
                            .attr("r", function (d) {
                                return d.size;
                            })
                            .style("fill", "red");

                    $('svg circle').tipsy({
                        gravity: 'w',
                        html: true,
                        title: function () {
                            var d = this.__data__;

                            return "<div class='hover-text'><div class='hospital-name'>" + d.name
                                    + "</div><div class='avg-price'>Average Price: $" + formatMoney(d.price, 0, '.', ',')
                                    + "</div></div>";
                        }
                    });


                });
            });
        }

        function spinner_on() {
            $("svg").remove();

            var e = document.getElementById("drug_name");
            var drg_num = e.options[e.selectedIndex].value;

            draw_chart(drg_num);

        }


        function formatMoney(n, c, d, t) {
            var c = isNaN(c = Math.abs(c)) ? 2 : c,
                    d = d == undefined ? "." : d,
                    t = t == undefined ? "," : t,
                    s = n < 0 ? "-" : "",
                    i = parseInt(n = Math.abs(+n || 0).toFixed(c)) + "",
                    j = (j = i.length) > 3 ? j % 3 : 0;
            return s + (j ? i.substr(0, j) + t : "") + i.substr(j).replace(/(\d{3})(?=\d)/g, "$1" + t) + (c ? d + Math.abs(n - i).toFixed(c).slice(2) : "");
        }

        spinner_on();


    </script>

    <script type="text/javascript">
        var switchTo5x = false;
    </script>
    <script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
    <script type="text/javascript">
        stLight.options({
            publisher: "6d8da8ae-b61c-486f-a29b-e4c32b2e3259",
            doNotHash: false,
            doNotCopy: false,
            hashAddressBar: false
        });
    </script>

{% endblock %}
